<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.111.3"><meta name=description content="Cray Site Initializer documentation"><meta name=author content="Cray-HPE"><link rel=icon href=/cray-site-init/images/favicon.png type=image/png><title>Running integration tests with canu and csi - Cray Site Init</title><link href=/cray-site-init/css/nucleus.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/fontawesome-all.min.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/hybrid.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/featherlight.min.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/perfect-scrollbar.min.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/auto-complete.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/atom-one-dark-reasonable.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/theme.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/tabs.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/hugo-theme.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/theme-blue.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/foo.css?1681407555 rel=stylesheet><link href=/cray-site-init/css/bar.css?1681407555 rel=stylesheet><script src=/cray-site-init/js/jquery-3.3.1.min.js?1681407555></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/cray-site-init/shcds/running_integration_tests/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><svg viewBox="0 0 240 80" xmlns="http://www.w3.org/2000/svg"><style>.small{font:italic 13px sans-serif}.heavy{font:700 30px sans-serif}</style><text x="40" y="35" class="heavy">CSI</text><text x="55" y="55" class="small">Cray Site Initializer</text></svg></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/cray-site-init/js/lunr.min.js?1681407555></script>
<script type=text/javascript src=/cray-site-init/js/auto-complete.js?1681407555></script>
<script type=text/javascript>var baseurl="https://cray-hpe.github.io/cray-site-init/"</script><script type=text/javascript src=/cray-site-init/js/search.js?1681407555></script></div><div class=highlightable><ul class=topics><li data-nav-id=/cray-site-init/commands/ title=Commands class=dd-item><a href=/cray-site-init/commands/>Commands
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/cray-site-init/commands/iuf-installer/ title=iuf-installer class=dd-item><a href=/cray-site-init/commands/iuf-installer/>iuf-installer
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_completion/ title="iuf-installer completion" class=dd-item><a href=/cray-site-init/commands/iuf-installer_completion/>iuf-installer completion
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_completion_bash/ title="iuf-installer completion bash" class=dd-item><a href=/cray-site-init/commands/iuf-installer_completion_bash/>iuf-installer completion bash
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_completion_fish/ title="iuf-installer completion fish" class=dd-item><a href=/cray-site-init/commands/iuf-installer_completion_fish/>iuf-installer completion fish
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_completion_powershell/ title="iuf-installer completion powershell" class=dd-item><a href=/cray-site-init/commands/iuf-installer_completion_powershell/>iuf-installer completion powershell
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_completion_zsh/ title="iuf-installer completion zsh" class=dd-item><a href=/cray-site-init/commands/iuf-installer_completion_zsh/>iuf-installer completion zsh
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_init/ title="iuf-installer init" class=dd-item><a href=/cray-site-init/commands/iuf-installer_init/>iuf-installer init
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/commands/iuf-installer_makedocs/ title="iuf-installer makedocs" class=dd-item><a href=/cray-site-init/commands/iuf-installer_makedocs/>iuf-installer makedocs
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/cray-site-init/shcds/ title=SHCDs class="dd-item
parent"><a href=/cray-site-init/shcds/>SHCDs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/cray-site-init/shcds/running_integration_tests/ title="Running integration tests with canu and csi" class="dd-item active"><a href=/cray-site-init/shcds/running_integration_tests/>Running integration tests with canu and csi
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/cray-site-init/shcds/using_shcds/ title="Using a canu-generated shcd.json with csi" class=dd-item><a href=/cray-site-init/shcds/using_shcds/>Using a canu-generated shcd.json with csi
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a> from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://github.com/Cray-HPE/cray-site-init/tree/main/hugo/content/shcds/running_integration_tests.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/cray-site-init/>IUF Installer</a> > <a href=/cray-site-init/shcds/>SHCDs</a> > Running integration tests with canu and csi</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#add-shcdxlsx-files-into-testdatashcds>Add <code>shcd.xlsx</code> files into <code>testdata/shcds</code></a></li><li><a href=#add-testdata>Add testdata</a></li><li><a href=#run-make-shcds>Run <code>make shcds</code></a></li><li><a href=#watch-the-files-get-created-in-testdatashcds>Watch the files get created in <code>testdata/shcds</code></a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Running integration tests with canu and csi</h1><p>The SHCD is the beginning source-of-truth for how a system is laid out and connected. The information found there is used through several different tools throughout the install of CSM, so if changes are made to an SHCD, it can be beneficial in both development and production environments to see how those changes might propagate.</p><p>To that end, there are some integration tests built in to <code>csi</code> that can test the flow mentioned above, which allow you to generate seed files for multiple systems at once.</p><h1 id=high-level-overview>High-level overview</h1><ol><li>Add <code>shcd.xlsx</code> files into <code>testdata/shcds</code></li><li>Add testdata</li><li>Run <code>make shcds</code></li><li>Watch the files get created in <code>testdata/shcds</code></li></ol><h2 id=add-shcdxlsx-files-into-testdatashcds>Add <code>shcd.xlsx</code> files into <code>testdata/shcds</code></h2><p>Put a copy of each <code>shcd.xlsx</code> you want to generate files for into <code>testdata/shcds</code>.</p><pre tabindex=0><code>~/cray-site-init $ ls -l testdata/shcds/
total 68120
-rw-r--r--@ 1 seymour  12790  4957149 Oct 27 08:41 HPE System 598 Shasta River Odin_RevA22.xlsx
-rw-r--r--@ 1 seymour  12790  5177069 Nov  2 13:13 Hela.xlsx
-rw-r--r--@ 1 seymour  12790  3877457 Nov  1 12:35 Shasta River Drax CCD.xlsx
-rw-r--r--@ 1 seymour  12790  1684315 Nov  1 12:45 Shasta River Fanta CCD.xlsx
-rw-r--r--@ 1 seymour  12790  1672018 Nov  2 13:23 Shasta River Redbull SHCD.xlsx
-rw-r--r--@ 1 seymour  12790  3491609 Nov  2 13:39 Shasta River Rocket SHCD.xlsx
-rw-r--r--@ 1 seymour  12790  2669723 Nov  2 13:15 Shasta River System_Ego_CCD.xlsx
-rw-r--r--@ 1 seymour  12790  1677461 Nov  1 13:46 Shasta River Thanos SHCD.xlsx
-rw-r--r--@ 1 seymour  12790  3896541 Nov  1 15:05 System3 Baldar Shasta  River.xlsx
-rw-r--r--@ 1 seymour  12790  2744277 Nov  1 13:57 System4 Sif Shasta River.xlsx
-rw-r--r--@ 1 seymour  12790  3007754 Nov  1 15:36 System6 Loki Shasta  River  SHCD.xlsx
</code></pre><h2 id=add-testdata>Add testdata</h2><p><code>canu</code> requires several arguments in order to generate an <code>shcd.json</code>. The necessary arguments can be added to the <code>tests</code> struct in <code>cmd/shcd_integration_test.go</code> similar to the example below.</p><pre tabindex=0><code>var canus = []struct {
	systemName string
	version    string
	tabs       string
	corners    string
}{
	{
		systemName: &#34;mysupercomputer&#34;,
		version:    &#34;V1&#34;,
		tabs:       &#34;25G_10G,NMN,HMN&#34;,
		corners:    &#34;I14,S65,J16,T23,J20,U46&#34;,
	},
</code></pre><h2 id=run-make-shcds>Run <code>make shcds</code></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># make sure canu is installed</span>
</span></span><span style=display:flex><span>make shcds
</span></span></code></pre></div><h2 id=watch-the-files-get-created-in-testdatashcds>Watch the files get created in <code>testdata/shcds</code></h2><p>On a successful test, you&rsquo;ll see output similar to:</p><pre tabindex=0><code>=== RUN   TestConfigShcd_GenerateSeeds
2021/11/02 12:47:54 Running canu to create shcd.json for baldar...
2021/11/02 12:47:56 Using schema file: ../internal/files/shcd-schema.json
2021/11/02 12:47:56 Created switch_metadata.csv from SHCD data
2021/11/02 12:47:56 Created hmn_connections.json from SHCD data
2021/11/02 12:47:56 Running canu to create shcd.json for drax...
2021/11/02 12:47:58 Using schema file: ../internal/files/shcd-schema.json
2021/11/02 12:47:58 Created switch_metadata.csv from SHCD data
2021/11/02 12:47:56 Created hmn_connections.json from SHCD data
2021/11/02 12:47:58 Running canu to create shcd.json for ego...
...
...
</code></pre><p><code>testdata/shcds/</code> will also have folders matching each of the system names and contain the following files:</p><ul><li><code>application_node_config.yaml</code></li><li><code>shcd.json</code></li><li><code>switch_metadata.csv</code></li><li><code>hmn_connections.json</code></li></ul><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/cray-site-init/js/clipboard.min.js?1681407555></script>
<script src=/cray-site-init/js/perfect-scrollbar.min.js?1681407555></script>
<script src=/cray-site-init/js/perfect-scrollbar.jquery.min.js?1681407555></script>
<script src=/cray-site-init/js/jquery.sticky.js?1681407555></script>
<script src=/cray-site-init/js/featherlight.min.js?1681407555></script>
<script src=/cray-site-init/js/highlight.pack.js?1681407555></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/cray-site-init/js/modernizr.custom-3.6.0.js?1681407555></script>
<script src=/cray-site-init/js/learn.js?1681407555></script>
<script src=/cray-site-init/js/hugo-learn.js?1681407555></script>
<script src=/cray-site-init/mermaid/mermaid.js?1681407555></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>